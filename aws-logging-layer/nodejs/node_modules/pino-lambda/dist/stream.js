"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createStream = void 0;
const formatters_1 = require("./formatters");
/**
 * Custom destination stream for Pino
 * @param options Pino options
 * @param storageProvider Global storage provider for request values
 */
const createStream = (options) => ({
    write(buffer) {
        let output = buffer;
        if (!options.prettyPrint) {
            const formatter = (options === null || options === void 0 ? void 0 : options.formatter) || new formatters_1.CloudwatchLogFormatter();
            output = formatter.format(buffer, options);
            // replace characters for proper formatting
            output = output.replace(/\n/, '\r');
            // final entry must end with carriage return
            output += '\n';
        }
        if (options.streamWriter) {
            return options.streamWriter(output);
        }
        return process.stdout.write(output);
    },
});
exports.createStream = createStream;
